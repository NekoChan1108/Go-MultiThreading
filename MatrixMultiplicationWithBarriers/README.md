# ä¸¤ä¸ª Barrier çš„ä½œç”¨

æ¯ä¸€è½®è®©æ‰€æœ‰ goroutine åŒæ—¶å¼€å§‹è®¡ç®—å¹¶ç¡®ä¿å…¨éƒ¨å®ŒæˆåŽå†è¿›å…¥ä¸‹ä¸€è½®

# Barrier å¤§å°ä¸º matrixSize + 1

æ˜¯å› ä¸ºé™¤äº† matrixSize ä¸ª worker goroutine main ä¹Ÿæ˜¯ä¸€ä¸ªå‚ä¸Žè€…è¿›è¡ŒçŸ©é˜µç”Ÿæˆçš„æ“ä½œ

# å…³äºŽmainé‡Œç”ŸæˆçŸ©é˜µçš„ä¹‹åŽçš„ä¸¤ä¸ªwait

```
main          worker0        worker1 ... workerN
â”€â”€genâ”€â”€â”
â”‚      wait           wait          wait
workStart.Wait() â€”â€”å¼€é—¸â€”â€”> compute â€”â€”> workComplete.Wait()
â”‚                                   â”‚
workComplete.Wait() <â€”â€”å¼€é—¸â€”â€”< done        done
```

* ç¬¬ä¸€ä¸ª workStart.Wait() æŠŠ main é˜»å¡žä½ç›´åˆ° æ‰€æœ‰ worker ä¹Ÿè°ƒç”¨äº† workStart.Wait() æ­¤æ—¶å¤§å®¶åŒæ—¶è¶Šè¿‡èµ·è·‘çº¿
* ç´§æŽ¥ç€çš„ workComplete.Wait() åˆæŠŠ main é˜»å¡žä½ç›´åˆ°æ‰€æœ‰ worker è°ƒç”¨ workComplete.Wait() æ­¤æ—¶å¤§å®¶åŒæ—¶è¶Šè¿‡ç»ˆç‚¹çº¿

# ðŸšª é—¸é—¨ 1ï¼šworkStart

## ä½œç”¨ï¼šç¡®ä¿â€œæ‰€æœ‰äººåˆ°é½åŽæ‰ä¸€èµ·å¼€å§‹è®¡ç®—â€

|            æ—¶é—´ç‚¹            |              æ­£åœ¨å‘ç”Ÿçš„äº‹               |
|:-------------------------:|:---------------------------------:|
|       main ç”Ÿæˆå®Œ Aã€B        | main åœ¨ `workStart.Wait()` å¤„**å µä½** |
|       250 ä¸ª worker        |  å„è‡ªåœ¨ `workStart.Wait()` å¤„**å µä½**   |
| å½“ç¬¬ 251 ä¸ªäººï¼ˆmain + 250ï¼‰å…¨éƒ¨åˆ°è¾¾ |       **é—¸é—¨æ‰“å¼€**ï¼Œæ‰€æœ‰äºº**åŒæ—¶è¶Šè¿‡**        |
|            ç´§æŽ¥ç€            |       250 ä¸ª worker å¹¶è¡Œè®¡ç®—å„è‡ªçš„è¡Œ       |

# ðŸšª é—¸é—¨ 2ï¼šworkComplete

## ä½œç”¨ï¼šç¡®ä¿â€œæ‰€æœ‰äººéƒ½ç®—å®ŒåŽæ‰ä¸€èµ·è¿›å…¥ä¸‹ä¸€è½®â€

|       æ—¶é—´ç‚¹        |             æ­£åœ¨å‘ç”Ÿçš„äº‹              |
|:----------------:|:-------------------------------:|
| æ¯ä¸ª worker ç®—å®Œè‡ªå·±çš„è¡Œ | åœ¨ `workComplete.Wait()` å¤„**å µä½** |
|     main ä¹Ÿåœ¨ç­‰     | åœ¨ `workComplete.Wait()` å¤„**å µä½** |
|  å½“ç¬¬ 251 ä¸ªäººå…¨éƒ¨åˆ°è¾¾   |      **é—¸é—¨æ‰“å¼€**ï¼Œæ‰€æœ‰äºº**åŒæ—¶è¶Šè¿‡**       |
|     main ç»§ç»­      |            ç”Ÿæˆä¸‹ä¸€è½® Aã€B            |

# æ•´ä½“æµç¨‹

```
main
â”œâ”€ ç”ŸæˆçŸ©é˜µ Aã€B
â”œâ”€ workStart.Wait()   â† ä¸»çº¿ç¨‹æŒ‚èµ·
â”‚
â”‚   250 æ¡ worker
â”‚   â”œâ”€ workStart.Wait() â† åŒæ ·æŒ‚èµ·
â”‚   â”‚
â”‚   â”‚  æ‰€æœ‰äººåˆ°é½åŽ Barrier æ”¾è¡Œ
â”‚   â”‚
â”‚   â”œâ”€ å¹¶è¡Œè®¡ç®—ï¼ˆmain ä»ç„¶æŒ‚èµ·ï¼‰
â”‚   â”‚     worker0 ç®— row0
â”‚   â”‚     worker1 ç®— row1
â”‚   â”‚     â€¦
â”‚   â”‚
â”‚   â””â”€ workComplete.Wait() â† ç®—å®ŒåŽæŒ‚èµ·
â”‚
â””â”€ workComplete.Wait() â† ä¸»çº¿ç¨‹è¢«å”¤é†’
  ï¼ˆæ‰€æœ‰ worker ä¹Ÿå·²åˆ°é½ï¼‰
```

![flow.png](flow.png)

